@using Final_ShoppingOnline.Models.Models.ProductModel
@model IEnumerable<ProductModel>

@{
    ViewData["Title"] = "List Product";
}

<!-- product quick view modal - start
================================================== -->
@if (Model != null && Model.Any())
{
    // Hiển thị quick view modal - chỉ hiển thị một modal cho tất cả sản phẩm
    <div class="modal fade" id="quickview_popup" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalToggleLabel2">Product Quick View</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="product_details">
                        <div class="container">
                            <div class="row">
                                <div class="col col-lg-6">
                                    <div class="product_details_image p-0">
                                        <img src="" id="quickview-image" alt="">
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="product_details_content">
                                        <h2 class="item_title" id="quickview-title"></h2>
                                        <p id="quickview-description"></p>
                                        <div class="item_review">
                                            <ul class="rating_star ul_li" id="quickview-rating"></ul>
                                            <span class="review_value" id="quickview-rating-count"></span>
                                        </div>
                                        <div class="item_price">
                                            <span id="quickview-sale-price"></span>
                                            <del id="quickview-price"></del>
                                        </div>

                                        <hr>

                                        <div class="item_attribute">
                                            <h3 class="title_text">Options <span class="underline"></span></h3>
                                            <form action="#">
                                                <div class="row" id="quickview-options">
                                                </div>
                                                <span class="repuired_text">Required Fields *</span>
                                            </form>
                                        </div>

                                        <div class="quantity_wrap">
                                            <form action="#">
                                                <div class="quantity_input">
                                                    <button type="button" class="input_number_decrement">
                                                        <i class="fal fa-minus"></i>
                                                    </button>
                                                    <input class="input_number" type="text" value="1">
                                                    <button type="button" class="input_number_increment">
                                                        <i class="fal fa-plus"></i>
                                                    </button>
                                                </div>
                                            </form>

                                            <div class="total_price">
                                                Total: <span id="quickview-total-price"></span>
                                            </div>
                                        </div>

                                        <ul class="default_btns_group ul_li">
                                            <li><a class="addtocart_btn" asp-controller="Cart" asp-action="AddToCart" id="quickview-add-to-cart">Add To Cart</a></li>
                                            <li><a href="#!"><i class="fa-solid fa-arrows-rotate"></i></a></li>
                                            <li><a href="#!"><i class="fas fa-heart"></i></a></li>
                                        </ul>

                                        <ul class="default_share_links ul_li">
                                            <li>
                                                <a class="share" href="#!">
                                                    <span><i class="fas fa-plus-square"></i> Share</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    // Hiển thị thông báo lỗi nếu Model rỗng hoặc null
    <p>No products found.</p>
}
<!-- product quick view modal - end
================================================== -->
<!-- breadcrumb_section - start
================================================== -->
<div class="breadcrumb_section">
    <div class="container">
        <ul class="breadcrumb_nav ul_li">
            <li><a asp-controller="Home" asp-action="Index">Home</a></li>
            <li>List Product</li>
        </ul>
    </div>
</div>
<!-- breadcrumb_section - end
================================================== -->
<!-- product_section - start
================================================== -->
<section class="product_section section_space">
    <div class="container">
        <div class="row">
            <div class="col-lg-9">
                <div class="filter_topbar">
                    <div class="row align-items-center">
                        <div class="col col-md-4 col-sm-4">
                            <ul class="layout_btns nav" role="tablist">
                                <li role="presentation">
                                    <button class="active" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">
                                        <i class="fal fa-bars"></i>
                                    </button>
                                </li>
                                <li role="presentation">
                                    <button data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">
                                        <i class="fal fa-th-large"></i>
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <div class="col col-md-4 col-sm-4">
                            <form action="#">
                                <div class="select_option clearfix">
                                    <select>
                                        <option data-display="Defaul Sorting">Select Your Option</option>
                                        <option value="1">Sorting By Name</option>
                                        <option value="2">Sorting By Price</option>
                                    </select>
                                </div>
                            </form>
                        </div>

                        <div class="col col-md-4 col-sm-4">
                            <div class="result_text">Showing 1-12 of @Model.Count() results</div>
                        </div>
                    </div>
                </div>

                <hr>

                <div class="tab-content">
                    <div class="tab-pane fade show active" id="home" role="tabpanel">
                        <div class="product_wrap">
                            @foreach (var product in Model)
                            {
                                <div class="product_layout1">
                                    @if (product.Status == ProductStatus.Hot)
                                    {
                                        <div class="item_badge hot_badge">
                                            <span>HOT</span>
                                        </div>
                                    }
                                    else if (product.Status == ProductStatus.New)
                                    {
                                        <div class="item_badge new_badge">
                                            <span>NEW</span>
                                        </div>
                                    }
                                    else if (product.Status == ProductStatus.Sale)
                                    {
                                        <div class="item_badge sale_badge">
                                            <span>SALE</span>
                                        </div>
                                    }

                                    <div class="item_image">
                                        <img src="@product.ImageUrl" alt="@product.Name">
                                        <img src="@product.HoverImageUrl" alt="@product.Name">
                                        <a class="quickview_btn" data-bs-toggle="modal" href="#quickview_popup" role="button"
                                           onclick="showQuickView(@product.Id)">Quick View</a>
                                    </div>
                                    <div class="item_content">
                                        <h3 class="item_title">
                                            <a asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">@product.Name</a>
                                        </h3>
                                        <ul class="rating_star ul_li">
                                            @for (int i = 0; i < product.StarRating; i++)
                                            {
                                                <li><i class="fa-solid fa-star"></i></li>
                                            }
                                            @for (int i = product.StarRating; i < 5; i++)
                                            {
                                                <li><i class="fa-regular fa-star"></i></li>
                                            }
                                        </ul>
                                        <div class="item_price">
                                            <span>@product.SalePrice.ToString("C")</span>
                                            <del>@product.Price.ToString("C")</del>
                                        </div>
                                        <ul class="item_btns_group ul_li">
                                            <li><a class="addtocart_btn" asp-controller="Cart" asp-action="AddToCart" asp-route-id="@product.Id">Add To Cart</a></li>
                                            <li><a href="#!"><i class="fa-solid fa-arrows-rotate"></i></a></li>
                                            <li><a href="#!"><i class="fas fa-heart"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                            }
                        </div>

                        <div class="pagination_wrap">
                            <ul class="pagination_nav ul_li_right">
                                <li class="active"><a href="#!">1</a></li>
                                <li><a href="#!">2</a></li>
                                <li><a href="#!">3</a></li>
                                <li class="prev_btn"><a asp-action="Previous"><i class="fa-regular fa-angle-left"></i></a></li>
                                <li class="next_btn"><a asp-action="Next"><i class="fa-regular fa-angle-right"></i></a></li>
                            </ul>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="profile" role="tabpanel">
                        <div class="product_layout2_wrap">
                            @foreach (var product in Model)
                            {
                                <div class="product_layout2">
                                    <div class="item_image">
                                        <a class="image_wrap" asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">
                                            <img src="@product.ImageUrl" alt="@product.Name">
                                        </a>
                                    </div>
                                    <div class="item_content">
                                        <h3 class="item_title">
                                            <a asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">@product.Name</a>
                                        </h3>
                                        <ul class="rating_star ul_li">
                                            @for (int i = 0; i < product.StarRating; i++)
                                            {
                                                <li><i class="fa-solid fa-star"></i></li>
                                            }
                                            @for (int i = product.StarRating; i < 5; i++)
                                            {
                                                <li><i class="fa-regular fa-star"></i></li>
                                            }
                                        </ul>
                                        <p>
                                            @product.Description
                                        </p>
                                        <div class="item_price">
                                            <span>@product.SalePrice.ToString("C")</span>
                                            <del>@product.Price.ToString("C")</del>
                                        </div>
                                        <ul class="item_btns_group ul_li">
                                            <li><a class="addtocart_btn" asp-controller="Cart" asp-action="AddToCart" asp-route-id="@product.Id">Add To Cart</a></li>
                                            <li><a href="#!"><i class="fa-solid fa-arrows-rotate"></i></a></li>
                                            <li><a href="#!"><i class="fas fa-heart"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                            }
                        </div>

                        <div class="pagination_wrap">
                            <ul class="pagination_nav ul_li_right">
                                <li class="active"><a href="#!">1</a></li>
                                <li><a href="#!">2</a></li>
                                <li><a href="#!">3</a></li>
                                <li class="prev_btn"><a asp-action="Previous"><i class="fa-regular fa-angle-left"></i></a></li>
                                <li class="next_btn"><a asp-action="Next"><i class="fa-regular fa-angle-right"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!--Danh mục-->
            <div class="col-lg-3 order-lg-first">
                <aside class="sidebar_section ps-0 mt-lg-0">
                    <div class="sb_widget sb_category">
                        <h3 class="sb_widget_title">Categories</h3>
                        <ul class="sb_category_list ul_li_block">
                            @foreach (var category in ViewBag.Categories)
                            {
                                <li><a asp-controller="Product" asp-action="Index" asp-route-categoryId="@category.Id">@category.Name <span></span></a></li>
                            }
                        </ul>
                    </div>

                    <div class="sb_widget sb_category">
                        <h3 class="sb_widget_title">Brands</h3>
                        <ul class="sb_category_list ul_li_block">
                            @foreach (var brand in ViewBag.Brands)
                            {
                                // Khai báo productCount bên ngoài vòng lặp
                                int productCount;
                                // Lấy số lượng sản phẩm từ ViewBag.BrandCounts
                                productCount = ViewBag.BrandCounts.First(new Func<BrandProductCountModel, bool>(bc => bc.BrandId == brand.Id))?.Count ?? 0;

                                <li><a asp-controller="Product" asp-action="Index" asp-route-brandId="@brand.Id">@brand.Name <span>(@productCount)</span></a></li>
                            }
                        </ul>
                    </div>

                    <div class="sb_widget">
                        <h3 class="sb_widget_title">Your Filter</h3>
                        <div class="filter_sidebar">
                            <div class="fs_widget">
                                <h3 class="fs_widget_title">Category</h3>
                                <form action="#">
                                    <div class="select_option clearfix">
                                        <select>
                                            <option data-display="Select Category">Select Your Option</option>
                                            @foreach (var category in ViewBag.Categories)
                                            {
                                                <option value="@category.Id">@category.Name</option>
                                            }
                                        </select>
                                    </div>
                                </form>
                            </div>

                            <div class="fs_widget">
                                <h3 class="fs_widget_title">Brands</h3>
                                <form action="#">
                                    <ul class="fs_brand_list ul_li_block">
                                        @foreach (var brand in ViewBag.Brands)
                                        {
                                            <li>
                                                <div class="checkbox_item">
                                                    <input id="@brand.Name" type="checkbox" name="brand_checkbox">
                                                    @* <label for="@brand.Name">@brand.Name <span>(@productCount)</span></label> *@
                                                </div>
                                            </li>
                                        }
                                    </ul>
                                </form>
                            </div>

                            <div class="fs_widget">
                                <h3 class="fs_widget_title">Price</h3>
                                <form asp-controller="Product" asp-action="FilterByPrice">
                                    <div class="price-range-area clearfix">
                                        <div class="price-text d-flex align-items-center">
                                            <span>Range:</span>
                                            <input type="text" id="amount" readonly>
                                        </div>
                                        <div id="slider-range" class="slider-range"></div>
                                    </div>
                                    <button type="submit" class="btn btn_primary">Apply Filter</button>
                                </form>
                            </div>

                            <div class="fs_widget">
                                <h3 class="fs_widget_title">Average Rating</h3>
                                <ul class="average_rating_list ul_li_block">
                                    @for (int i = 5; i > 0; i--)
                                    {
                                        <li>
                                            @for (int j = 0; j < i; j++)
                                            {
                                                <i class="fas fa-star"></i>
                                            }
                                            @for (int j = i; j < 5; j++)
                                            {
                                                <i class="far fa-star"></i>
                                            }
                                            <span>(@Model.Where(p => p.StarRating == i).Count())</span>
                                        </li>
                                    }
                                </ul>
                            </div>

                            <div class="fs_widget">
                                <h3 class="fs_widget_title">Filter by Memory</h3>
                                <ul class="filter_memory_list ul_li_block">
                                    @foreach (var option in ViewBag.MemoryFilters)
                                    {
                                        <li><a asp-controller="Product" asp-action="Index" asp-route-memoryFilter="@option.Value">@option.Value <span>(@option.Quantity)</span></a></li>
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="sb_widget latest_product_carousel mb-lg-0">
                        <div class="title_wrap">
                            <h3 class="area_title">Latest Products</h3>
                            <div class="carousel_nav">
                                <button type="button" class="vs4i_left_arrow"><i class="fa-regular fa-angle-left"></i></button>
                                <button type="button" class="vs4i_right_arrow"><i class="fa-regular fa-angle-right"></i></button>
                            </div>
                        </div>
                        <div class="vertical_slider_4item" data-slick='{"dots": false}'>
                            @foreach (var product in ViewBag.LatestProducts)
                            {
                                <div class="slider_item">
                                    <div class="small_product_layout">
                                        <a class="item_image" asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">
                                            <img src="@product.ImageUrl" alt="@product.Name">
                                        </a>
                                        <div class="item_content">
                                            <h3 class="item_title">
                                                <a asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">@product.Name</a>
                                            </h3>
                                            <ul class="rating_star ul_li">
                                                @for (int i = 0; i < product.StarRating; i++)
                                                {
                                                    <li><i class="fa-solid fa-star"></i></li>
                                                }
                                                @for (int i = product.StarRating; i < 5; i++)
                                                {
                                                    <li><i class="fa-regular fa-star"></i></li>
                                                }
                                            </ul>
                                            <div class="item_price">
                                                <span>@product.SalePrice.ToString("C")</span>
                                                <del>@product.Price.ToString("C")</del>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>
</section>
<!-- product_section - end
================================================== -->
@* @section Scripts {
    <script>
        // Hàm hiển thị Quick View
        function showQuickView(productId) {
            // Lấy thông tin sản phẩm từ Model
            var product = @Html.Raw(Json.Serialize(Model.FirstOrDefault(p => p.Id == productId)));

            // Cập nhật thông tin sản phẩm trong modal
            $("#quickview-image").attr("src", product.ImageUrl);
            $("#quickview-title").text(product.Name);
            $("#quickview-description").text(product.Description);

            // Hiển thị sao đánh giá
            var ratingHtml = "";
            for (var i = 0; i < product.StarRating; i++) {
                ratingHtml += '<li><i class="fa-solid fa-star"></i></li>';
            }
            for (var i = product.StarRating; i < 5; i++) {
                ratingHtml += '<li><i class="fa-regular fa-star"></i></li>';
            }
            $("#quickview-rating").html(ratingHtml);

            $("#quickview-rating-count").text(product.Reviews?.Count() ?? 0 + " Rating(s)");
            $("#quickview-price").text(product.Price.toLocaleString('en-US', { style: 'currency', currency: 'USD' }));
            $("#quickview-sale-price").text(product.SalePrice.toLocaleString('en-US', { style: 'currency', currency: 'USD' }));
            $("#quickview-total-price").text(product.SalePrice.toLocaleString('en-US', { style: 'currency', currency: 'USD' }));

            // Cập nhật nút "Add to Cart"
            $("#quickview-add-to-cart").attr("href", "/Cart/AddToCart/" + productId);

            // Hiển thị các tùy chọn
            var optionsHtml = "";
            if (product.Options != null) {
                product.Options.forEach(function (option) {
                    optionsHtml += '<div class="col col-md-6">' +
                        '<div class="select_option clearfix">' +
                        '<h4 class="input_title">' + option.Type + '</h4>' +
                        '<select>' +
                        '<option data-display="- Please select -">Choose A Option</option>' +
                        '<option value="' + option.Value + '">' + option.Value + '</option>' +
                        '</select>' +
                        '</div>' +
                        '</div>';
                });
            } else {
                optionsHtml += '<p>No options available for this product.</p>';
            }
            $("#quickview-options").html(optionsHtml);
        }
    </script>
} *@